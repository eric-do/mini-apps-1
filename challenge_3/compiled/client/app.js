const HOMEPAGE_VIEW = 0;
const REGISTRATION_VEW = 1;
const ADDRESS_VIEW = 2;
const CREDIT_VIEW = 3;
const CONFIRMATION_VIEW = 4;

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasPurchased: false,
      currentView: HOMEPAGE_VIEW,
      user: {}
    };
  }

  nextViewHandler(e) {
    if (e) {
      e.preventDefault();
    }
    //e.preventDefault();
    //this.postData();
    var currentView = this.state.currentView;
    currentView++;
    this.setView(currentView);
  }

  postData() {
    $.ajax({
      url: 'http://localhost:3000',
      method: 'POST',
      data: { user: this.state.user },
      success: data => {
        console.log('Success! Received: ' + data);
        var user = Object.assign(this.state.user);
        user['id'] = data;
        this.setState({
          user: user
        });
      },
      error: () => console.log('error')
    });
  }

  nextViewandPost(e) {
    this.nextViewHandler(e);
    this.postData();
  }

  nextViewAndGet(e) {
    e.preventDefault();
    $.ajax({
      url: 'http://localhost:3000/confirmation',
      method: 'POST',
      data: { user: this.state.user },
      success: data => {
        console.log('Success! ' + data);
        this.nextViewHandler();
      },
      error: () => console.log('error')
    });
  }

  handleSubmit(e) {
    e.preventDefault();
  }

  handleChange(e) {
    e.preventDefault();
    var name = e.target.id;
    var value = e.target.value;
    var user = Object.assign(this.state.user);
    user[name] = value;
    this.setState({
      user: user
    });
  }

  resetView(e) {
    e.preventDefault();
    var currentView = 0;
    this.setView(currentView);
  }

  setView(currentView) {
    this.setState({
      currentView: currentView
    });
  }

  render() {
    if (this.state.currentView === HOMEPAGE_VIEW) {
      return React.createElement(Homepage, { onClick: this.nextViewandPost.bind(this) });
    }

    if (this.state.currentView === REGISTRATION_VEW) {
      return React.createElement(Registration, { onClick: this.nextViewandPost.bind(this), onChange: this.handleChange.bind(this) });
    }

    if (this.state.currentView === ADDRESS_VIEW) {
      return React.createElement(Address, { onClick: this.nextViewandPost.bind(this), onChange: this.handleChange.bind(this) });
    }

    if (this.state.currentView === CREDIT_VIEW) {
      return React.createElement(CreditCard, { onClick: this.nextViewAndGet.bind(this), onChange: this.handleChange.bind(this) });
    }

    if (this.state.currentView === CONFIRMATION_VIEW) {
      return React.createElement(Confirmation, { onClick: this.resetView.bind(this), onChange: this.handleChange.bind(this) });
    }
  }
}

var Homepage = props => React.createElement(
  'div',
  { id: 'homepage' },
  React.createElement(
    'h1',
    null,
    'Homepage'
  ),
  React.createElement(
    'button',
    { onClick: props.onClick },
    'Checkout'
  )
);

var Registration = props => {
  return React.createElement(
    'div',
    { id: 'registration' },
    React.createElement(
      'h1',
      null,
      'Registration'
    ),
    React.createElement(
      'form',
      { onSubmit: props.handleSubmit },
      React.createElement('input', { id: 'username', type: 'text', placeholder: 'Name', onChange: e => props.onChange(e) }),
      React.createElement('input', { id: 'email', type: 'text', placeholder: 'Email', onChange: e => props.onChange(e) }),
      React.createElement('input', { id: 'password', type: 'text', placeholder: 'Password', onChange: e => props.onChange(e) }),
      React.createElement(
        'button',
        { onClick: e => props.onClick(e) },
        'Next'
      )
    )
  );
};

var Address = props => React.createElement(
  'div',
  { id: 'address' },
  React.createElement(
    'h1',
    null,
    'Address'
  ),
  React.createElement('input', { id: 'address1', type: 'text', placeholder: 'Line 1', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'address2', type: 'text', placeholder: 'Line 2', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'city', type: 'text', placeholder: 'City', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'state', type: 'text', placeholder: 'State', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'zip', type: 'text', placeholder: 'Zip Code', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'phone', type: 'text', placeholder: 'Phone number, e.g. (555)555-5555', onChange: e => props.onChange(e) }),
  React.createElement(
    'button',
    { onClick: e => props.onClick(e) },
    'Next'
  )
);

var CreditCard = props => React.createElement(
  'div',
  { id: 'address' },
  React.createElement(
    'h1',
    null,
    'Credit Card'
  ),
  React.createElement('input', { id: 'creditcard', type: 'text', placeholder: 'Credit card number', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'expiration', type: 'date', placeholder: 'Expiration date', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'cvv', type: 'text', placeholder: 'CVV', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'billing_zip', type: 'text', placeholder: 'Billing zip code', onChange: e => props.onChange(e) }),
  React.createElement(
    'button',
    { onClick: e => props.onClick(e) },
    'Next'
  )
);

var Confirmation = props => React.createElement(
  'div',
  { id: 'confirmation' },
  React.createElement(
    'h1',
    null,
    'Confirmation'
  ),
  React.createElement(
    'button',
    { onClick: e => props.onClick(e) },
    'Purchase'
  )
);

ReactDOM.render(React.createElement(App, null), document.getElementById(`app`));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NsaWVudC9hcHAuanN4Il0sIm5hbWVzIjpbIkhPTUVQQUdFX1ZJRVciLCJSRUdJU1RSQVRJT05fVkVXIiwiQUREUkVTU19WSUVXIiwiQ1JFRElUX1ZJRVciLCJDT05GSVJNQVRJT05fVklFVyIsIkFwcCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwiaGFzUHVyY2hhc2VkIiwiY3VycmVudFZpZXciLCJ1c2VyIiwibmV4dFZpZXdIYW5kbGVyIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic2V0VmlldyIsInBvc3REYXRhIiwiJCIsImFqYXgiLCJ1cmwiLCJtZXRob2QiLCJkYXRhIiwic3VjY2VzcyIsImNvbnNvbGUiLCJsb2ciLCJPYmplY3QiLCJhc3NpZ24iLCJzZXRTdGF0ZSIsImVycm9yIiwibmV4dFZpZXdhbmRQb3N0IiwibmV4dFZpZXdBbmRHZXQiLCJoYW5kbGVTdWJtaXQiLCJoYW5kbGVDaGFuZ2UiLCJuYW1lIiwidGFyZ2V0IiwiaWQiLCJ2YWx1ZSIsInJlc2V0VmlldyIsInJlbmRlciIsImJpbmQiLCJIb21lcGFnZSIsIm9uQ2xpY2siLCJSZWdpc3RyYXRpb24iLCJvbkNoYW5nZSIsIkFkZHJlc3MiLCJDcmVkaXRDYXJkIiwiQ29uZmlybWF0aW9uIiwiUmVhY3RET00iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxnQkFBZ0IsQ0FBdEI7QUFDQSxNQUFNQyxtQkFBbUIsQ0FBekI7QUFDQSxNQUFNQyxlQUFlLENBQXJCO0FBQ0EsTUFBTUMsY0FBYyxDQUFwQjtBQUNBLE1BQU1DLG9CQUFvQixDQUExQjs7QUFFQSxNQUFNQyxHQUFOLFNBQWtCQyxNQUFNQyxTQUF4QixDQUFrQztBQUNoQ0MsY0FBWUMsS0FBWixFQUFtQjtBQUNqQixVQUFNQSxLQUFOO0FBQ0EsU0FBS0MsS0FBTCxHQUFhO0FBQ1hDLG9CQUFjLEtBREg7QUFFWEMsbUJBQWFaLGFB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LE9BQU4sQ0FBYzVCLENBQWQsQ0FBeEI7QUFBQTtBQUFBO0FBTkYsQ0FERjs7QUFXQSxJQUFJaUMsZUFBZ0J2QyxLQUFELElBQ2pCO0FBQUE7QUFBQSxJQUFLLElBQUcsY0FBUjtBQUNFO0FBQUE7QUFBQTtBQUFBO0FBQUEsR0FERjtBQUVFO0FBQUE7QUFBQSxNQUFRLFNBQVVNLENBQUQsSUFBT04sTUFBTWtDLE9BQU4sQ0FBYzVCLENBQWQsQ0FBeEI7QUFBQTtBQUFBO0FBRkYsQ0FERjs7QUFRQWtDLFNBQVNULE1BQVQsQ0FBZ0Isb0JBQUMsR0FBRCxPQUFoQixFQUF3QlUsU0FBU0MsY0FBVCxDQUF5QixLQUF6QixDQUF4QiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBIT01FUEFHRV9WSUVXID0gMDtcbmNvbnN0IFJFR0lTVFJBVElPTl9WRVcgPSAxO1xuY29uc3QgQUREUkVTU19WSUVXID0gMjtcbmNvbnN0IENSRURJVF9WSUVXID0gMztcbmNvbnN0IENPTkZJUk1BVElPTl9WSUVXID0gNDtcblxuY2xhc3MgQXBwIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcylcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaGFzUHVyY2hhc2VkOiBmYWxzZSxcbiAgICAgIGN1cnJlbnRWaWV3OiBIT01FUEFHRV9WSUVXLFxuICAgICAgdXNlcjoge31cbiAgICB9XG4gIH1cblxuICBuZXh0Vmlld0hhbmRsZXIoZSkge1xuICAgIGlmIChlKSB7IGUucHJldmVudERlZmF1bHQoKTsgfVxuICAgIC8vZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vdGhpcy5wb3N0RGF0YSgpO1xuICAgIHZhciBjdXJyZW50VmlldyA9IHRoaXMuc3RhdGUuY3VycmVudFZpZXc7XG4gICAgY3VycmVudFZpZXcrKztcbiAgICB0aGlzLnNldFZpZXcoY3VycmVudFZpZXcpO1xuICB9XG5cbiAgcG9zdERhdGEoKSB7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcsXG4gICAgICBtZXRob2Q6ICdQT1NUJywgXG4gICAgICBkYXRhOiB7dXNlciA6IHRoaXMuc3RhdGUudXNlcn0sXG4gICAgICBzdWNjZXNzOiAoZGF0YSkgPT4geyBcbiAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3MhIFJlY2VpdmVkOiAnICsgZGF0YSk7XG4gICAgICAgIHZhciB1c2VyID0gT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLnVzZXIpO1xuICAgICAgICB1c2VyWydpZCddID0gZGF0YTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgdXNlcjogdXNlclxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogKCkgPT4gY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICB9KTtcbiAgfVxuXG4gIG5leHRWaWV3YW5kUG9zdChlKSB7XG4gICAgdGhpcy5uZXh0Vmlld0hhbmRsZXIoZSk7XG4gICAgdGhpcy5wb3N0RGF0YSgpO1xuICB9XG5cbiAgbmV4dFZpZXdBbmRHZXQoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2NvbmZpcm1hdGlvbicsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IHsgdXNlcjogdGhpcy5zdGF0ZS51c2VyIH0sXG4gICAgICBzdWNjZXNzOiAoZGF0YSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnU3VjY2VzcyEgJyArIGRhdGEpO1xuICAgICAgICB0aGlzLm5leHRWaWV3SGFuZGxlcigpO1xuICAgICAgfSxcbiAgICAgIGVycm9yOiAoKSA9PiBjb25zb2xlLmxvZygnZXJyb3InKVxuICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlU3VibWl0KGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgbmFtZSA9IGUudGFyZ2V0LmlkO1xuICAgIHZhciB2YWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgIHZhciB1c2VyID0gT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLnVzZXIpO1xuICAgIHVzZXJbbmFtZV0gPSB2YWx1ZTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHVzZXI6IHVzZXJcbiAgICB9KTtcbiAgfVxuXG4gIHJlc2V0VmlldyhlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHZhciBjdXJyZW50VmlldyA9IDA7XG4gICAgdGhpcy5zZXRWaWV3KGN1cnJlbnRWaWV3KTtcbiAgfVxuXG4gIHNldFZpZXcoY3VycmVudFZpZXcpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGN1cnJlbnRWaWV3OiBjdXJyZW50Vmlld1xuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRWaWV3ID09PSBIT01FUEFHRV9WSUVXKSB7XG4gICAgICByZXR1cm4gKDxIb21lcGFnZSBvbkNsaWNrPXt0aGlzLm5leHRWaWV3YW5kUG9zdC5iaW5kKHRoaXMpfSAvPilcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50VmlldyA9PT0gUkVHSVNUUkFUSU9OX1ZFVykge1xuICAgICAgcmV0dXJuICg8UmVnaXN0cmF0aW9uIG9uQ2xpY2s9e3RoaXMubmV4dFZpZXdhbmRQb3N0LmJpbmQodGhpcyl9IG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpfS8+KVxuICAgIH1cblxuICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRWaWV3ID09PSBBRERSRVNTX1ZJRVcpIHtcbiAgICAgIHJldHVybiAoPEFkZHJlc3Mgb25DbGljaz17dGhpcy5uZXh0Vmlld2FuZFBvc3QuYmluZCh0aGlzKX0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlLmJpbmQodGhpcyl9Lz4pXG4gICAgfVxuICBcbiAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50VmlldyA9PT0gQ1JFRElUX1ZJRVcpIHtcbiAgICAgIHJldHVybiAoPENyZWRpdENhcmQgb25DbGljaz17dGhpcy5uZXh0Vmlld0FuZEdldC5iaW5kKHRoaXMpfSBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2UuYmluZCh0aGlzKX0vPilcbiAgICB9XG4gIFxuICAgIGlmICh0aGlzLnN0YXRlLmN1cnJlbnRWaWV3ID09PSBDT05GSVJNQVRJT05fVklFVykge1xuICAgICAgcmV0dXJuICg8Q29uZmlybWF0aW9uIG9uQ2xpY2s9e3RoaXMucmVzZXRWaWV3LmJpbmQodGhpcyl9IG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpfS8+KVxuICAgIH1cbiAgfVxufVxuXG52YXIgSG9tZXBhZ2UgPSAocHJvcHMpID0+IChcbiAgPGRpdiBpZD1cImhvbWVwYWdlXCI+XG4gICAgPGgxPkhvbWVwYWdlPC9oMT5cbiAgICA8YnV0dG9uIG9uQ2xpY2s9e3Byb3BzLm9uQ2xpY2t9PkNoZWNrb3V0PC9idXR0b24+XG4gIDwvZGl2PlxuKVxuXG52YXIgUmVnaXN0cmF0aW9uID0gKHByb3BzKSA9PiB7XG4gIHJldHVybiAoXG4gIDxkaXYgaWQ9XCJyZWdpc3RyYXRpb25cIj5cbiAgICA8aDE+UmVnaXN0cmF0aW9uPC9oMT5cbiAgICA8Zm9ybSBvblN1Ym1pdD17cHJvcHMuaGFuZGxlU3VibWl0fT5cbiAgICAgIDxpbnB1dCBpZD1cInVzZXJuYW1lXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIk5hbWVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgICAgPGlucHV0IGlkPVwiZW1haWxcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiRW1haWxcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgICAgPGlucHV0IGlkPVwicGFzc3dvcmRcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiUGFzc3dvcmRcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoZSkgPT4gcHJvcHMub25DbGljayhlKX0+TmV4dDwvYnV0dG9uPlxuICAgIDwvZm9ybT5cbiAgPC9kaXY+KTtcbn1cblxudmFyIEFkZHJlc3MgPSAocHJvcHMpID0+IChcbiAgPGRpdiBpZD1cImFkZHJlc3NcIj5cbiAgICA8aDE+QWRkcmVzczwvaDE+XG4gICAgPGlucHV0IGlkPVwiYWRkcmVzczFcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiTGluZSAxXCIgb25DaGFuZ2U9eyhlKSA9PiBwcm9wcy5vbkNoYW5nZShlKX0+PC9pbnB1dD5cbiAgICA8aW5wdXQgaWQ9XCJhZGRyZXNzMlwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJMaW5lIDJcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cImNpdHlcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiQ2l0eVwiIG9uQ2hhbmdlPXsoZSkgPT4gcHJvcHMub25DaGFuZ2UoZSl9PjwvaW5wdXQ+XG4gICAgPGlucHV0IGlkPVwic3RhdGVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiU3RhdGVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cInppcFwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJaaXAgQ29kZVwiIG9uQ2hhbmdlPXsoZSkgPT4gcHJvcHMub25DaGFuZ2UoZSl9PjwvaW5wdXQ+XG4gICAgPGlucHV0IGlkPVwicGhvbmVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiUGhvbmUgbnVtYmVyLCBlLmcuICg1NTUpNTU1LTU1NTVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxidXR0b24gb25DbGljaz17KGUpID0+IHByb3BzLm9uQ2xpY2soZSl9Pk5leHQ8L2J1dHRvbj5cbiAgPC9kaXY+XG4pXG5cbnZhciBDcmVkaXRDYXJkID0gKHByb3BzKSA9PiAoXG4gIDxkaXYgaWQ9XCJhZGRyZXNzXCI+XG4gICAgPGgxPkNyZWRpdCBDYXJkPC9oMT5cbiAgICA8aW5wdXQgaWQ9XCJjcmVkaXRjYXJkXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkNyZWRpdCBjYXJkIG51bWJlclwiIG9uQ2hhbmdlPXsoZSkgPT4gcHJvcHMub25DaGFuZ2UoZSl9PjwvaW5wdXQ+XG4gICAgPGlucHV0IGlkPVwiZXhwaXJhdGlvblwiIHR5cGU9XCJkYXRlXCIgcGxhY2Vob2xkZXI9XCJFeHBpcmF0aW9uIGRhdGVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cImN2dlwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJDVlZcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cImJpbGxpbmdfemlwXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkJpbGxpbmcgemlwIGNvZGVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxidXR0b24gb25DbGljaz17KGUpID0+IHByb3BzLm9uQ2xpY2soZSl9Pk5leHQ8L2J1dHRvbj5cbiAgPC9kaXY+XG4pXG5cbnZhciBDb25maXJtYXRpb24gPSAocHJvcHMpID0+IChcbiAgPGRpdiBpZD1cImNvbmZpcm1hdGlvblwiPlxuICAgIDxoMT5Db25maXJtYXRpb248L2gxPlxuICAgIDxidXR0b24gb25DbGljaz17KGUpID0+IHByb3BzLm9uQ2xpY2soZSl9PlB1cmNoYXNlPC9idXR0b24+XG4gIDwvZGl2PlxuKVxuXG5cblJlYWN0RE9NLnJlbmRlcig8QXBwLz4sIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBhcHBgKSk7Il19