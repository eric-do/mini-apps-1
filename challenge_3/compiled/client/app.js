const HOMEPAGE_VIEW = 0;
const REGISTRATION_VEW = 1;
const ADDRESS_VIEW = 2;
const CREDIT_VIEW = 3;
const CONFIRMATION_VIEW = 4;

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasPurchased: false,
      currentView: HOMEPAGE_VIEW,
      user: {}
    };
  }

  nextViewHandler(e) {
    if (e) {
      e.preventDefault();
    }
    //e.preventDefault();
    //this.postData();
    var currentView = this.state.currentView;
    currentView++;
    this.setView(currentView);
  }

  postData() {
    $.ajax({
      url: 'http://localhost:3000',
      method: 'POST',
      data: { user: this.state.user },
      success: data => {
        console.log('Success! Received: ' + data);
        var user = Object.assign(this.state.user);
        user['id'] = data;
        this.setState({
          user: user
        });
      },
      error: () => console.log('error')
    });
  }

  nextViewandPost(e) {
    this.nextViewHandler(e);
    this.postData();
  }

  nextViewAndGet(e) {
    e.preventDefault();
    $.ajax({
      url: 'http://localhost:3000/confirmation',
      method: 'POST',
      data: { user: this.state.user },
      success: data => {
        console.log('Success! ' + data);
        this.nextViewHandler();
      },
      error: () => console.log('error')
    });
  }

  handleSubmit(e) {
    e.preventDefault();
  }

  handleChange(e) {
    e.preventDefault();
    var name = e.target.id;
    var value = e.target.value;
    var user = Object.assign(this.state.user);
    user[name] = value;
    this.setState({
      user: user
    });
  }

  resetView(e) {
    e.preventDefault();
    var currentView = 0;
    this.setView(currentView);
  }

  setView(currentView) {
    this.setState({
      currentView: currentView
    });
  }

  render() {
    if (this.state.currentView === HOMEPAGE_VIEW) {
      return React.createElement(Homepage, { onClick: this.nextViewandPost.bind(this) });
    }

    if (this.state.currentView === REGISTRATION_VEW) {
      return React.createElement(Registration, { onClick: this.nextViewandPost.bind(this), onChange: this.handleChange.bind(this) });
    }

    if (this.state.currentView === ADDRESS_VIEW) {
      return React.createElement(Address, { onClick: this.nextViewandPost.bind(this), onChange: this.handleChange.bind(this) });
    }

    if (this.state.currentView === CREDIT_VIEW) {
      return React.createElement(CreditCard, { onClick: this.nextViewAndGet.bind(this), onChange: this.handleChange.bind(this) });
    }

    if (this.state.currentView === CONFIRMATION_VIEW) {
      return React.createElement(Confirmation, { user: this.state.user, onClick: this.resetView.bind(this), onChange: this.handleChange.bind(this) });
    }
  }
}

var Homepage = props => React.createElement(
  'div',
  { id: 'homepage' },
  React.createElement(
    'h1',
    null,
    'Homepage'
  ),
  React.createElement(
    'button',
    { onClick: props.onClick },
    'Checkout'
  )
);

var Registration = props => {
  return React.createElement(
    'div',
    { id: 'registration' },
    React.createElement(
      'h1',
      null,
      'Registration'
    ),
    React.createElement(
      'form',
      { onSubmit: props.handleSubmit },
      React.createElement('input', { id: 'username', type: 'text', placeholder: 'Name', onChange: e => props.onChange(e) }),
      React.createElement('input', { id: 'email', type: 'text', placeholder: 'Email', onChange: e => props.onChange(e) }),
      React.createElement('input', { id: 'password', type: 'text', placeholder: 'Password', onChange: e => props.onChange(e) }),
      React.createElement(
        'button',
        { onClick: e => props.onClick(e) },
        'Next'
      )
    )
  );
};

var Address = props => React.createElement(
  'div',
  { id: 'address' },
  React.createElement(
    'h1',
    null,
    'Address'
  ),
  React.createElement('input', { id: 'address1', type: 'text', placeholder: 'Line 1', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'address2', type: 'text', placeholder: 'Line 2', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'city', type: 'text', placeholder: 'City', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'state', type: 'text', placeholder: 'State', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'zip', type: 'text', placeholder: 'Zip Code', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'phone', type: 'text', placeholder: 'Phone number, e.g. (555)555-5555', onChange: e => props.onChange(e) }),
  React.createElement(
    'button',
    { onClick: e => props.onClick(e) },
    'Next'
  )
);

var CreditCard = props => React.createElement(
  'div',
  { id: 'address' },
  React.createElement(
    'h1',
    null,
    'Credit Card'
  ),
  React.createElement('input', { id: 'creditcard', type: 'text', placeholder: 'Credit card number', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'expiration', type: 'date', placeholder: 'Expiration date', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'cvv', type: 'text', placeholder: 'CVV', onChange: e => props.onChange(e) }),
  React.createElement('input', { id: 'billing_zip', type: 'text', placeholder: 'Billing zip code', onChange: e => props.onChange(e) }),
  React.createElement(
    'button',
    { onClick: e => props.onClick(e) },
    'Next'
  )
);

var Confirmation = props => React.createElement(
  'div',
  { id: 'confirmation' },
  React.createElement(
    'h1',
    null,
    'Confirmation'
  ),
  Object.keys(props.user).map(key => React.createElement(
    'div',
    null,
    key,
    ' : ',
    props.user[key]
  )),
  React.createElement(
    'button',
    { onClick: e => props.onClick(e) },
    'Purchase'
  )
);

ReactDOM.render(React.createElement(App, null), document.getElementById(`app`));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NsaWVudC9hcHAuanN4Il0sIm5hbWVzIjpbIkhPTUVQQUdFX1ZJRVciLCJSRUdJU1RSQVRJT05fVkVXIiwiQUREUkVTU19WSUVXIiwiQ1JFRElUX1ZJRVciLCJDT05GSVJNQVRJT05fVklFVyIsIkFwcCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwiaGFzUHVyY2hhc2VkIiwiY3VycmVudFZpZXciLCJ1c2VyIiwibmV4dFZpZXdIYW5kbGVyIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic2V0VmlldyIsInBvc3REYXRhIiwiJCIsImFqYXgiLCJ1cmwiLCJtZXRob2QiLCJkYXRhIiwic3VjY2VzcyIsImNvbnNvbGUiLCJsb2ciLCJPYmplY3QiLCJhc3NpZ24iLCJzZXRTdGF0ZSIsImVycm9yIiwibmV4dFZpZXdhbmRQb3N0IiwibmV4dFZpZXdBbmRHZXQiLCJoYW5kbGVTdWJtaXQiLCJoYW5kbGVDaGFuZ2UiLCJuYW1lIiwidGFyZ2V0IiwiaWQiLCJ2YWx1ZSIsInJlc2V0VmlldyIsInJlbmRlciIsImJpbmQiLCJIb21lcGFnZSIsIm9uQ2xpY2siLCJSZWdpc3RyYXRpb24iLCJvbkNoYW5nZSIsIkFkZHJlc3MiLCJDcmVkaXRDYXJkIiwiQ29uZmlybWF0aW9uIiwia2V5cyIsIm1hcCIsImtleSIsIlJlYWN0RE9NIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsZ0JBQWdCLENBQXRCO0FBQ0EsTUFBTUMsbUJBQW1CLENBQXpCO0FBQ0EsTUFBTUMsZUFBZSxDQUFyQjtBQUNBLE1BQU1DLGNBQWMsQ0FBcEI7QUFDQSxNQUFNQyxvQkFBb0IsQ0FBMUI7O0FBRUEsTUFBTUMsR0FBTixTQUFrQkMsTUFBTUMsU0FBeEIsQ0FBa0M7QUFDaENDLGNBQVlDLEtBQVosRUFBbUI7QUFDakIsVUFBTUEsS0FBTjtBQUNBLFNBQUtDLEtBQUwsR0FBYTtBQUNYQyxvQkFBYyxL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QUFwRixHQUxGO0FBTUU7QUFBQTtBQUFBLE1BQVEsU0FBVUEsQ0FBRCxJQUFPTixNQUFNa0MsT0FBTixDQUFjNUIsQ0FBZCxDQUF4QjtBQUFBO0FBQUE7QUFORixDQURGOztBQVdBLElBQUlpQyxlQUFnQnZDLEtBQUQsSUFDakI7QUFBQTtBQUFBLElBQUssSUFBRyxjQUFSO0FBQ0U7QUFBQTtBQUFBO0FBQUE7QUFBQSxHQURGO0FBR0lrQixTQUFPc0IsSUFBUCxDQUFZeEMsTUFBTUksSUFBbEIsRUFBd0JxQyxHQUF4QixDQUE0QkMsT0FDMUI7QUFBQTtBQUFBO0FBQU1BLE9BQU47QUFBQTtBQUFjMUMsVUFBTUksSUFBTixDQUFXc0MsR0FBWDtBQUFkLEdBREYsQ0FISjtBQU9FO0FBQUE7QUFBQSxNQUFRLFNBQVVwQyxDQUFELElBQU9OLE1BQU1rQyxPQUFOLENBQWM1QixDQUFkLENBQXhCO0FBQUE7QUFBQTtBQVBGLENBREY7O0FBYUFxQyxTQUFTWixNQUFULENBQWdCLG9CQUFDLEdBQUQsT0FBaEIsRUFBd0JhLFNBQVNDLGNBQVQsQ0FBeUIsS0FBekIsQ0FBeEIiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgSE9NRVBBR0VfVklFVyA9IDA7XG5jb25zdCBSRUdJU1RSQVRJT05fVkVXID0gMTtcbmNvbnN0IEFERFJFU1NfVklFVyA9IDI7XG5jb25zdCBDUkVESVRfVklFVyA9IDM7XG5jb25zdCBDT05GSVJNQVRJT05fVklFVyA9IDQ7XG5cbmNsYXNzIEFwcCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGhhc1B1cmNoYXNlZDogZmFsc2UsXG4gICAgICBjdXJyZW50VmlldzogSE9NRVBBR0VfVklFVyxcbiAgICAgIHVzZXI6IHt9XG4gICAgfVxuICB9XG5cbiAgbmV4dFZpZXdIYW5kbGVyKGUpIHtcbiAgICBpZiAoZSkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH1cbiAgICAvL2UucHJldmVudERlZmF1bHQoKTtcbiAgICAvL3RoaXMucG9zdERhdGEoKTtcbiAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzLnN0YXRlLmN1cnJlbnRWaWV3O1xuICAgIGN1cnJlbnRWaWV3Kys7XG4gICAgdGhpcy5zZXRWaWV3KGN1cnJlbnRWaWV3KTtcbiAgfVxuXG4gIHBvc3REYXRhKCkge1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsIFxuICAgICAgZGF0YToge3VzZXIgOiB0aGlzLnN0YXRlLnVzZXJ9LFxuICAgICAgc3VjY2VzczogKGRhdGEpID0+IHsgXG4gICAgICAgIGNvbnNvbGUubG9nKCdTdWNjZXNzISBSZWNlaXZlZDogJyArIGRhdGEpO1xuICAgICAgICB2YXIgdXNlciA9IE9iamVjdC5hc3NpZ24odGhpcy5zdGF0ZS51c2VyKTtcbiAgICAgICAgdXNlclsnaWQnXSA9IGRhdGE7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIHVzZXI6IHVzZXJcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgZXJyb3I6ICgpID0+IGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgfSk7XG4gIH1cblxuICBuZXh0Vmlld2FuZFBvc3QoZSkge1xuICAgIHRoaXMubmV4dFZpZXdIYW5kbGVyKGUpO1xuICAgIHRoaXMucG9zdERhdGEoKTtcbiAgfVxuXG4gIG5leHRWaWV3QW5kR2V0KGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9jb25maXJtYXRpb24nLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiB7IHVzZXI6IHRoaXMuc3RhdGUudXNlciB9LFxuICAgICAgc3VjY2VzczogKGRhdGEpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3MhICcgKyBkYXRhKTtcbiAgICAgICAgdGhpcy5uZXh0Vmlld0hhbmRsZXIoKTtcbiAgICAgIH0sXG4gICAgICBlcnJvcjogKCkgPT4gY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZVN1Ym1pdChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgaGFuZGxlQ2hhbmdlKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgdmFyIG5hbWUgPSBlLnRhcmdldC5pZDtcbiAgICB2YXIgdmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcbiAgICB2YXIgdXNlciA9IE9iamVjdC5hc3NpZ24odGhpcy5zdGF0ZS51c2VyKTtcbiAgICB1c2VyW25hbWVdID0gdmFsdWU7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB1c2VyOiB1c2VyXG4gICAgfSk7XG4gIH1cblxuICByZXNldFZpZXcoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgY3VycmVudFZpZXcgPSAwO1xuICAgIHRoaXMuc2V0VmlldyhjdXJyZW50Vmlldyk7XG4gIH1cblxuICBzZXRWaWV3KGN1cnJlbnRWaWV3KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBjdXJyZW50VmlldzogY3VycmVudFZpZXdcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50VmlldyA9PT0gSE9NRVBBR0VfVklFVykge1xuICAgICAgcmV0dXJuICg8SG9tZXBhZ2Ugb25DbGljaz17dGhpcy5uZXh0Vmlld2FuZFBvc3QuYmluZCh0aGlzKX0gLz4pXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc3RhdGUuY3VycmVudFZpZXcgPT09IFJFR0lTVFJBVElPTl9WRVcpIHtcbiAgICAgIHJldHVybiAoPFJlZ2lzdHJhdGlvbiBvbkNsaWNrPXt0aGlzLm5leHRWaWV3YW5kUG9zdC5iaW5kKHRoaXMpfSBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2UuYmluZCh0aGlzKX0vPilcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50VmlldyA9PT0gQUREUkVTU19WSUVXKSB7XG4gICAgICByZXR1cm4gKDxBZGRyZXNzIG9uQ2xpY2s9e3RoaXMubmV4dFZpZXdhbmRQb3N0LmJpbmQodGhpcyl9IG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpfS8+KVxuICAgIH1cbiAgXG4gICAgaWYgKHRoaXMuc3RhdGUuY3VycmVudFZpZXcgPT09IENSRURJVF9WSUVXKSB7XG4gICAgICByZXR1cm4gKDxDcmVkaXRDYXJkIG9uQ2xpY2s9e3RoaXMubmV4dFZpZXdBbmRHZXQuYmluZCh0aGlzKX0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlLmJpbmQodGhpcyl9Lz4pXG4gICAgfVxuICBcbiAgICBpZiAodGhpcy5zdGF0ZS5jdXJyZW50VmlldyA9PT0gQ09ORklSTUFUSU9OX1ZJRVcpIHtcbiAgICAgIHJldHVybiAoPENvbmZpcm1hdGlvbiB1c2VyPXt0aGlzLnN0YXRlLnVzZXJ9IG9uQ2xpY2s9e3RoaXMucmVzZXRWaWV3LmJpbmQodGhpcyl9IG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZS5iaW5kKHRoaXMpfS8+KVxuICAgIH1cbiAgfVxufVxuXG52YXIgSG9tZXBhZ2UgPSAocHJvcHMpID0+IChcbiAgPGRpdiBpZD1cImhvbWVwYWdlXCI+XG4gICAgPGgxPkhvbWVwYWdlPC9oMT5cbiAgICA8YnV0dG9uIG9uQ2xpY2s9e3Byb3BzLm9uQ2xpY2t9PkNoZWNrb3V0PC9idXR0b24+XG4gIDwvZGl2PlxuKVxuXG52YXIgUmVnaXN0cmF0aW9uID0gKHByb3BzKSA9PiB7XG4gIHJldHVybiAoXG4gIDxkaXYgaWQ9XCJyZWdpc3RyYXRpb25cIj5cbiAgICA8aDE+UmVnaXN0cmF0aW9uPC9oMT5cbiAgICA8Zm9ybSBvblN1Ym1pdD17cHJvcHMuaGFuZGxlU3VibWl0fT5cbiAgICAgIDxpbnB1dCBpZD1cInVzZXJuYW1lXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIk5hbWVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgICAgPGlucHV0IGlkPVwiZW1haWxcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiRW1haWxcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgICAgPGlucHV0IGlkPVwicGFzc3dvcmRcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiUGFzc3dvcmRcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoZSkgPT4gcHJvcHMub25DbGljayhlKX0+TmV4dDwvYnV0dG9uPlxuICAgIDwvZm9ybT5cbiAgPC9kaXY+KTtcbn1cblxudmFyIEFkZHJlc3MgPSAocHJvcHMpID0+IChcbiAgPGRpdiBpZD1cImFkZHJlc3NcIj5cbiAgICA8aDE+QWRkcmVzczwvaDE+XG4gICAgPGlucHV0IGlkPVwiYWRkcmVzczFcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiTGluZSAxXCIgb25DaGFuZ2U9eyhlKSA9PiBwcm9wcy5vbkNoYW5nZShlKX0+PC9pbnB1dD5cbiAgICA8aW5wdXQgaWQ9XCJhZGRyZXNzMlwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJMaW5lIDJcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cImNpdHlcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiQ2l0eVwiIG9uQ2hhbmdlPXsoZSkgPT4gcHJvcHMub25DaGFuZ2UoZSl9PjwvaW5wdXQ+XG4gICAgPGlucHV0IGlkPVwic3RhdGVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiU3RhdGVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cInppcFwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJaaXAgQ29kZVwiIG9uQ2hhbmdlPXsoZSkgPT4gcHJvcHMub25DaGFuZ2UoZSl9PjwvaW5wdXQ+XG4gICAgPGlucHV0IGlkPVwicGhvbmVcIiB0eXBlPVwidGV4dFwiIHBsYWNlaG9sZGVyPVwiUGhvbmUgbnVtYmVyLCBlLmcuICg1NTUpNTU1LTU1NTVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxidXR0b24gb25DbGljaz17KGUpID0+IHByb3BzLm9uQ2xpY2soZSl9Pk5leHQ8L2J1dHRvbj5cbiAgPC9kaXY+XG4pXG5cbnZhciBDcmVkaXRDYXJkID0gKHByb3BzKSA9PiAoXG4gIDxkaXYgaWQ9XCJhZGRyZXNzXCI+XG4gICAgPGgxPkNyZWRpdCBDYXJkPC9oMT5cbiAgICA8aW5wdXQgaWQ9XCJjcmVkaXRjYXJkXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkNyZWRpdCBjYXJkIG51bWJlclwiIG9uQ2hhbmdlPXsoZSkgPT4gcHJvcHMub25DaGFuZ2UoZSl9PjwvaW5wdXQ+XG4gICAgPGlucHV0IGlkPVwiZXhwaXJhdGlvblwiIHR5cGU9XCJkYXRlXCIgcGxhY2Vob2xkZXI9XCJFeHBpcmF0aW9uIGRhdGVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cImN2dlwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJDVlZcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxpbnB1dCBpZD1cImJpbGxpbmdfemlwXCIgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkJpbGxpbmcgemlwIGNvZGVcIiBvbkNoYW5nZT17KGUpID0+IHByb3BzLm9uQ2hhbmdlKGUpfT48L2lucHV0PlxuICAgIDxidXR0b24gb25DbGljaz17KGUpID0+IHByb3BzLm9uQ2xpY2soZSl9Pk5leHQ8L2J1dHRvbj5cbiAgPC9kaXY+XG4pXG5cbnZhciBDb25maXJtYXRpb24gPSAocHJvcHMpID0+IChcbiAgPGRpdiBpZD1cImNvbmZpcm1hdGlvblwiPlxuICAgIDxoMT5Db25maXJtYXRpb248L2gxPlxuICAgIHtcbiAgICAgIE9iamVjdC5rZXlzKHByb3BzLnVzZXIpLm1hcChrZXkgPT4gKFxuICAgICAgICA8ZGl2PntrZXl9IDoge3Byb3BzLnVzZXJba2V5XX08L2Rpdj5cbiAgICAgICkpXG4gICAgfVxuICAgIDxidXR0b24gb25DbGljaz17KGUpID0+IHByb3BzLm9uQ2xpY2soZSl9PlB1cmNoYXNlPC9idXR0b24+XG4gIDwvZGl2PlxuKVxuXG5cblJlYWN0RE9NLnJlbmRlcig8QXBwLz4sIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBhcHBgKSk7Il19